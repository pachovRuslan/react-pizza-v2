{"ast":null,"code":"import _objectSpread from\"D:/.vscode/react-pizza-v2/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _toConsumableArray from\"D:/.vscode/react-pizza-v2/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _regeneratorRuntime from\"D:/.vscode/react-pizza-v2/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"D:/.vscode/react-pizza-v2/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";/* eslint-disable */import React from'react';import qs from'qs';import{useSelector}from'react-redux';import{Link,useNavigate}from'react-router-dom';import{Categories,Sort,PizzaBlock,Skeleton,Pagination}from'../components/';import{setCategoryId,setCurrentPage,setFilters}from'../redux/Slices/filter/slice';import{fetchPizzas}from'../redux/Slices/pizza/slice';import{selectPizzaData}from'../redux/Slices/pizza/selectors';import{selectFilter}from'../redux/Slices/filter/selectors';import{useAppDispatch}from'../redux/store';import{list}from'../components/Sort';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Home=function Home(){var navigate=useNavigate();var dispatch=useAppDispatch();var isSearch=React.useRef(false);var isMounted=React.useRef(false);var _useSelector=useSelector(selectFilter),categoryId=_useSelector.categoryId,sort=_useSelector.sort,currentPage=_useSelector.currentPage,searchValue=_useSelector.searchValue;var _useSelector2=useSelector(selectPizzaData),items=_useSelector2.items,status=_useSelector2.status;var onChangeCategory=React.useCallback(function(idx){dispatch(setCategoryId(idx));},[]);var onChangePage=function onChangePage(page){dispatch(setCurrentPage(page));};var getPizzas=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var order,sortBy,category,search;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:order=sort.sortProperty.includes('-')?'asc':'desc';sortBy=sort.sortProperty.replace('-','');category=categoryId>0?\"category=\".concat(categoryId):'';search=searchValue?\"&search=\".concat(searchValue):'';dispatch(fetchPizzas({order:order,sortBy:sortBy,category:category,search:search,currentPage:String(currentPage)}));case 5:case\"end\":return _context.stop();}}},_callee);}));return function getPizzas(){return _ref.apply(this,arguments);};}();React.useEffect(function(){if(isMounted.current){var queryString=qs.stringify({sortProperty:sort.sortProperty,categoryId:categoryId,currentPage:currentPage});navigate(\"?\".concat(queryString));}isMounted.current=true;},[categoryId,sort.sortProperty,currentPage]);React.useEffect(function(){if(window.location.search){var params=qs.parse(window.location.search.substring(1));var _sort=list.find(function(obj){return obj.sortProperty===params.sortBy;});dispatch(setFilters({searchValue:params.search,categoryId:Number(params.category),currentPage:Number(params.currentPage),sort:_sort||list[0]}));isSearch.current=true;}},[]);React.useEffect(function(){window.scrollTo(0,0);if(!isSearch.current){getPizzas();}isSearch.current=false;},[categoryId,sort.sortProperty,currentPage]);var skeletons=_toConsumableArray(new Array(8)).map(function(_,index){return/*#__PURE__*/_jsx(Skeleton,{},index);});var pizzas=items.map(function(obj){return/*#__PURE__*/_jsx(PizzaBlock,_objectSpread({},obj),obj.id);});return/*#__PURE__*/_jsxs(\"div\",{className:\"container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"content__top\",children:[/*#__PURE__*/_jsx(Categories,{categoryId:categoryId,onChangeCategory:onChangeCategory}),/*#__PURE__*/_jsx(Sort,{value:sort})]}),/*#__PURE__*/_jsx(\"h2\",{className:\"content__title\",children:\"\\u0412\\u0441\\u0435 \\u043F\\u0438\\u0446\\u0446\\u044B\"}),status==='error'?/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"h2\",{children:[\"\\u041F\\u0440\\u043E\\u0438\\u0437\\u043E\\u0448\\u043B\\u0430 \\u043E\\u0448\\u0438\\u0431\\u043A\\u0430 \",/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83D\\uDE15\"})]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u041D\\u0435 \\u0443\\u0434\\u0430\\u043B\\u043E\\u0441\\u044C \\u043F\\u043E\\u043B\\u0443\\u0447\\u0438\\u0442\\u044C \\u043F\\u0438\\u0446\\u0446\\u044B.\",/*#__PURE__*/_jsx(\"br\",{}),\"\\u041F\\u043E\\u043F\\u0440\\u043E\\u0431\\u0443\\u0439\\u0442\\u0435 \\u043F\\u043E\\u0432\\u0442\\u043E\\u0440\\u0438\\u0442\\u044C \\u043F\\u043E\\u043F\\u044B\\u0442\\u043A\\u0443 \\u043F\\u043E\\u0437\\u0436\\u0435\"]}),/*#__PURE__*/_jsxs(Link,{to:\"/\",className:\"button button--black\",children:[' ',/*#__PURE__*/_jsx(\"span\",{children:\"\\u0412\\u0435\\u0440\\u043D\\u0443\\u0442\\u044C\\u0441\\u044F \\u043D\\u0430\\u0437\\u0430\\u0434\"})]})]}):/*#__PURE__*/_jsx(\"div\",{className:\"content__items\",children:status==='loading'?skeletons:pizzas}),/*#__PURE__*/_jsx(Pagination,{currentPage:currentPage,onChangePage:onChangePage})]});};export default Home;","map":{"version":3,"names":["React","qs","useSelector","Link","useNavigate","Categories","Sort","PizzaBlock","Skeleton","Pagination","setCategoryId","setCurrentPage","setFilters","fetchPizzas","selectPizzaData","selectFilter","useAppDispatch","list","Home","navigate","dispatch","isSearch","useRef","isMounted","categoryId","sort","currentPage","searchValue","items","status","onChangeCategory","useCallback","idx","onChangePage","page","getPizzas","order","sortProperty","includes","sortBy","replace","category","search","String","useEffect","current","queryString","stringify","window","location","params","parse","substring","find","obj","Number","scrollTo","skeletons","Array","map","_","index","pizzas","id"],"sources":["D:/.vscode/react-pizza-v2/src/Pages/Home.tsx"],"sourcesContent":["/* eslint-disable */\r\nimport React from 'react';\r\nimport qs from 'qs';\r\nimport { useSelector } from 'react-redux';\r\nimport { Link, useNavigate } from 'react-router-dom';\r\n\r\nimport { Categories, Sort, PizzaBlock, Skeleton, Pagination } from '../components/';\r\n\r\nimport { setCategoryId, setCurrentPage, setFilters } from '../redux/Slices/filter/slice';\r\nimport { fetchPizzas, SearchPizzasParams } from '../redux/Slices/pizza/slice';\r\nimport { selectPizzaData } from '../redux/Slices/pizza/selectors';\r\nimport { selectFilter } from '../redux/Slices/filter/selectors';\r\nimport { useAppDispatch } from '../redux/store';\r\nimport { list } from '../components/Sort';\r\n\r\nconst Home: React.FC = () => {\r\n  const navigate = useNavigate();\r\n  const dispatch = useAppDispatch();\r\n  const isSearch = React.useRef(false);\r\n  const isMounted = React.useRef(false);\r\n\r\n  const { categoryId, sort, currentPage, searchValue } = useSelector(selectFilter);\r\n\r\n  const { items, status } = useSelector(selectPizzaData);\r\n\r\n  const onChangeCategory = React.useCallback((idx: number) => {\r\n    dispatch(setCategoryId(idx));\r\n  }, []);\r\n  const onChangePage = (page: number) => {\r\n    dispatch(setCurrentPage(page));\r\n  };\r\n  const getPizzas = async () => {\r\n    const order = sort.sortProperty.includes('-') ? 'asc' : 'desc';\r\n    const sortBy = sort.sortProperty.replace('-', '');\r\n    const category = categoryId > 0 ? `category=${categoryId}` : '';\r\n    const search = searchValue ? `&search=${searchValue}` : '';\r\n\r\n    dispatch(\r\n      fetchPizzas({\r\n        order,\r\n        sortBy,\r\n        category,\r\n        search,\r\n        currentPage: String(currentPage),\r\n      }),\r\n    );\r\n  };\r\n\r\n  React.useEffect(() => {\r\n    if (isMounted.current) {\r\n      const queryString = qs.stringify({\r\n        sortProperty: sort.sortProperty,\r\n        categoryId,\r\n        currentPage,\r\n      });\r\n      navigate(`?${queryString}`);\r\n    }\r\n    isMounted.current = true;\r\n  }, [categoryId, sort.sortProperty, currentPage]);\r\n\r\n  React.useEffect(() => {\r\n    if (window.location.search) {\r\n      const params = qs.parse(window.location.search.substring(1)) as unknown as SearchPizzasParams;\r\n      const sort = list.find((obj) => obj.sortProperty === params.sortBy);\r\n      dispatch(\r\n        setFilters({\r\n          searchValue: params.search,\r\n          categoryId: Number(params.category),\r\n          currentPage: Number(params.currentPage),\r\n          sort: sort || list[0],\r\n        }),\r\n      );\r\n      isSearch.current = true;\r\n    }\r\n  }, []);\r\n\r\n  React.useEffect(() => {\r\n    window.scrollTo(0, 0);\r\n    if (!isSearch.current) {\r\n      getPizzas();\r\n    }\r\n    isSearch.current = false;\r\n  }, [categoryId, sort.sortProperty, currentPage]);\r\n\r\n  const skeletons = [...new Array(8)].map((_, index) => <Skeleton key={index} />);\r\n  const pizzas = items.map((obj: any) => <PizzaBlock key={obj.id} {...obj} />);\r\n\r\n  return (\r\n    <div className=\"container\">\r\n      <div className=\"content__top\">\r\n        <Categories categoryId={categoryId} onChangeCategory={onChangeCategory} />\r\n        <Sort value={sort} />\r\n      </div>\r\n      <h2 className=\"content__title\">–í—Å–µ –ø–∏—Ü—Ü—ã</h2>\r\n      {status === 'error' ? (\r\n        <div>\r\n          <h2>\r\n            –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ <span>üòï</span>\r\n          </h2>\r\n          <p>\r\n            –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –ø–∏—Ü—Ü—ã.\r\n            <br />\r\n            –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É –ø–æ–∑–∂–µ\r\n          </p>\r\n          <Link to=\"/\" className=\"button button--black\">\r\n            {' '}\r\n            <span>–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥</span>\r\n          </Link>\r\n        </div>\r\n      ) : (\r\n        <div className=\"content__items\">{status === 'loading' ? skeletons : pizzas}</div>\r\n      )}\r\n      <Pagination currentPage={currentPage} onChangePage={onChangePage} />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Home;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}